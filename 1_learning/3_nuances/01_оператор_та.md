# Оператор "та" (AND) — зламаний

## Зміст

- [Симптоми](#симптоми)
- [Код, що НЕ працює](#код-що-не-працює)
- [Чому це відбувається](#чому-це-відбувається)
- [Рішення: вкладені якщо](#рішення-вкладені-якщо)
- [Приклади тестування](#приклади-тестування)
- [Верифікація](#верифікація)
- [Чому "або" працює, а "та" — ні?](#чому-або-працює-а-та--ні)

---

## Симптоми

Коли ви намагаєтеся використати оператор `та` (логічне AND) у будь-якому контексті, парсер видає помилку:

```
Помилка в файлі.м:X
Не вдалось розібрати на сполуки.
```

---

## Код, що НЕ працює

```мавка
дія перевірка_віку_та_росту(вік, зріст)
  якщо вік > 18 та зріст > 160
    вернути "підходить"
  інакше
    вернути "не підходить"
  кінець
кінець
```

При запуску цього коду ви отримаєте помилку парсера на рядку з `та`.

---

## Чому це відбувається

Парсер мови Мавка **не вміє токенізувати** ключове слово `та` у контексті умовних виразів. Це означає, що на рівні лексичного аналізу (перший етап компіляції) парсер не розпізнає `та` як валідний оператор.

**Технічна деталь:** Оператор `або` (OR) працює коректно, але `та` (AND) — ні. Це свідчить про неповну реалізацію логічних операторів у парсері.

---

## Рішення: вкладені якщо

Замість оператора `та` завжди використовуйте **вкладені блоки `якщо`**:

```мавка
дія перевірка_віку_та_росту(вік, зріст)
  якщо вік > 18
    якщо зріст > 160
      вернути "підходить"
    кінець
  кінець
  вернути "не підходить"
кінець
```

### Патерн для заміни

```мавка
; Замість цього:
якщо умова_1 та умова_2
  дія
кінець

; Використовуйте це:
якщо умова_1
  якщо умова_2
    дія
  кінець
кінець
```

---

## Приклади тестування

### Тест 1: Базовий AND

**Неправильно:**
```мавка
якщо температура > 20 та волога < 70
  друк("комфортно")
кінець
```

**Правильно:**
```мавка
якщо температура > 20
  якщо волога < 70
    друк("комфортно")
  кінець
кінець
```

---

### Тест 2: Потрійна умова

**Неправильно:**
```мавка
якщо а > 0 та б > 0 та ц > 0
  вернути "всі позитивні"
кінець
```

**Правильно:**
```мавка
якщо а > 0
  якщо б > 0
    якщо ц > 0
      вернути "всі позитивні"
    кінець
  кінець
кінець
```

---

### Тест 3: AND в циклі

**Неправильно:**
```мавка
перебрати масив як елемент
  якщо елемент > 10 та елемент < 50
    друк(елемент)
  кінець
кінець
```

**Правильно:**
```мавка
перебрати масив як елемент
  якщо елемент > 10
    якщо елемент < 50
      друк(елемент)
    кінець
  кінець
кінець
```

---

### Тест 4: Діапазон значень

**Неправильно:**
```мавка
дія чи_в_діапазоні(значення, мін, макс)
  якщо значення >= мін та значення <= макс
    вернути дійсне
  інакше
    вернути недійсне
  кінець
кінець
```

**Правильно:**
```мавка
дія чи_в_діапазоні(значення, мін, макс)
  якщо значення >= мін
    якщо значення <= макс
      вернути дійсне
    кінець
  кінець
  вернути недійсне
кінець
```

---

### Тест 5: Складна логіка з кількома умовами

**Неправильно:**
```мавка
дія перевірка_вступу(бали, вік, має_атестат)
  якщо бали >= 150 та вік >= 17 та має_атестат == дійсне
    вернути "прийнято"
  інакше
    вернути "відхилено"
  кінець
кінець
```

**Правильно:**
```мавка
дія перевірка_вступу(бали, вік, має_атестат)
  якщо бали >= 150
    якщо вік >= 17
      якщо має_атестат == дійсне
        вернути "прийнято"
      кінець
    кінець
  кінець
  вернути "відхилено"
кінець
```

---

## Верифікація

### Крок 1: Тест неправильного коду

Створіть тестовий файл `/tmp/тест_та.м`:

```мавка
дія тест(а, б)
  якщо а > 5 та б > 10
    вернути "так"
  інакше
    вернути "ні"
  кінець
кінець

друк(тест(10, 15))
```

Запустіть:
```bash
~/мавка /tmp/тест_та.м
```

**Очікуваний результат:** Помилка парсера "Не вдалось розібрати на сполуки."

---

### Крок 2: Тест правильного коду

Тепер виправте на вкладені `якщо`:

```мавка
дія тест(а, б)
  якщо а > 5
    якщо б > 10
      вернути "так"
    кінець
  кінець
  вернути "ні"
кінець

друк(тест(10, 15))
друк(тест(3, 15))
друк(тест(10, 5))
```

Запустіть:
```bash
~/мавка /tmp/тест_та.м
```

**Очікуваний результат:**
```
так
ні
ні
```

---

### Крок 3: Тест в циклі

Створіть файл `/tmp/тест_та_в_циклі.м`:

```мавка
дія фільтрувати_діапазон(масив, мін, макс)
  результат = []
  
  перебрати масив як елемент
    якщо елемент >= мін
      якщо елемент <= макс
        результат.додати(елемент)
      кінець
    кінець
  кінець
  
  вернути результат
кінець

числа = [5, 15, 25, 35, 45, 55]
відфільтровані = фільтрувати_діапазон(числа, 10, 40)
друк(відфільтровані)
```

**Очікуваний результат:**
```
[15, 25, 35]
```

---

## Чому "або" працює, а "та" — ні?

Це питання часто виникає у розробників. Ось експериментальна верифікація:

### Тест оператора `або` (OR)

```мавка
дія тест_або(а, б)
  якщо а > 10 або б > 10
    вернути "хоча б одна умова виконана"
  інакше
    вернути "жодна умова не виконана"
  кінець
кінець

друк(тест_або(15, 5))
друк(тест_або(5, 15))
друк(тест_або(5, 5))
```

**Результат:**
```
хоча б одна умова виконана
хоча б одна умова виконана
жодна умова не виконана
```

✅ **Оператор `або` працює коректно!**

---

### Пояснення

Оператор `або` (OR) був повністю реалізований в парсері, а оператор `та` (AND) — ні. Це може бути пов'язано з:

1. **Пріоритетом розробки:** OR часто вважається простішим у реалізації
2. **Неповною специфікацією:** Можливо, AND планувався, але не був завершений
3. **Залежністю від версії:** Можливо, в майбутніх версіях Мавки `та` буде працювати

**Висновок:** Поки `та` не працює, користуйтеся вкладеними `якщо`.

---

## Резюме

### Що не працює
- Оператор `та` в будь-якому контексті
- `якщо а та б` — не компілюється
- `поки х та у` — не компілюється

### Що працює
- Оператор `або` працює коректно
- Вкладені блоки `якщо` — надійне рішення
- Вкладені блоки працюють скрізь: у функціях, циклах, умовах

### Золоте правило
**Завжди замінюйте `та` на вкладені `якщо`** — це єдиний надійний спосіб реалізувати логічне AND у Мавці.

---

**Повернутися до:** [Огляд критичних обмежень](./00_огляд.md)

**Наступне обмеження:** [02. Ранні повернення в циклах](./02_повернення_в_циклах.md)

---

*Документ створено на основі емпіричного тестування парсера Мавки версії 0.124.1*  
*Останнє оновлення: 1 січня 2026*
